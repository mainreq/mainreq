{% load reqApp_tags %}

{% with stateTimeline=element|stateTimeline %}
    {% if stateTimeline %}
        <a  href="#narf"
            tabindex="0"
            data-toggle="popover"
            data-trigger="focus"
            data-html="true"
            title="Línea de Tiempo de Estados de {{ element.identifierText }}"
            data-content="
                <div statevolutionparent style='width:500px;height:2.4em;position:relative;overflow:hidden;border-left:1px solid Gray;border-right:1px solid Gray;'>
                
                    <span style='position:absolute;width:100%;padding-top:1.2em;'>
                        <span statevolution title='{{ element.date|date:'Y-m-d H:i' }} {{ element.date|date:'Y-m-d H:i' }}' data-toggle='tooltip' data-placement='bottom' style='cursor:default;background-color:Red;color:White;white-space:nowrap;overflow:hidden;left:4%;width:25%;text-overflow:ellipsis;position:absolute'>no cumple</span>
                        <span statevolution title='{{ element.date|date:'Y-m-d H:i' }} {{ element.date|date:'Y-m-d H:i' }}' data-toggle='tooltip' data-placement='bottom' style='cursor:default;background-color:Purple;color:White;white-space:nowrap;overflow:hidden;left:29%;width:55%;text-overflow:ellipsis;position:absolute'>ambiguo</span>
                        <span statevolution title='{{ element.date|date:'Y-m-d H:i' }} {{ element.date|date:'Y-m-d H:i' }}' data-toggle='tooltip' data-placement='bottom' style='cursor:default;background-color:Green;color:White;white-space:nowrap;overflow:hidden;left:82%;width:5%;text-overflow:ellipsis;position:absolute'>cumple</span>
                    </span>
                    
                    {% for inc in stateTimeline.increments %}
                        <span statevolution data-html='true' title='{{ inc.increment }}<br/>{{ inc.increment.initDate|date:'Y-m-d' }}<br/>{{ inc.increment.endDate|date:'Y-m-d' }}' data-toggle='tooltip' data-placement='top' style='cursor:default;border:1px solid Gray;color:Gray;white-space:nowrap;overflow:hidden;left:{{ inc.left }}%;width:{{ inc.width }}%;text-overflow:ellipsis;position:absolute'>{{ inc.increment }}</span>
                    {% endfor %}
                    
                    {% comment %}
                    <span statevolution title='{{ element.date|date:'Y-m-d H:i' }} {{ element.date|date:'Y-m-d H:i' }}' data-toggle='tooltip' data-placement='top' style='cursor:default;border:1px solid Gray;color:Gray;white-space:nowrap;overflow:hidden;width:50%;text-overflow:ellipsis;position:absolute'>Primera iteración</span>
                    
                    <span statevolution title='{{ element.date|date:'Y-m-d H:i' }} {{ element.date|date:'Y-m-d H:i' }}' data-toggle='tooltip' data-placement='top' style='cursor:default;border:1px solid Gray;color:Gray;white-space:nowrap;overflow:hidden;left:50%;width:50%;text-overflow:ellipsis;position:absolute'>Segunda iteración</span>
                    {% endcomment %}
                </div>
                <script>
                    var self = $('[data-toggle=tooltip][statevolution]');
                    self.tooltip({container:self.closest('[statevolutionparent]').parent()});
                </script>
            ">
            (línea de tiempo...)
        </a>
        <script>
            $('[data-toggle=popover]').popover({
                container:'body',
                template:'<div class="popover" role="tooltip" style="max-width:none;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',
            });
        </script>
    {% endif %}
{% endwith %}
